<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro ID Card Maker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* --- Mobile Responsive Preview Scale --- */
        .preview-container {
            container-type: inline-size;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            overflow: hidden;
            padding: 20px;
        }

        /* Scale logic for preview only */
        @media (max-width: 640px) {
            .preview-card-scale {
                transform: scale(0.85); 
                transform-origin: center;
            }
        }
        @media (max-width: 380px) {
            .preview-card-scale {
                transform: scale(0.70);
            }
        }

        /* --- PRINT SETTINGS (A4 Optimized) --- */
        @media print {
            @page {
                size: A4;
                margin: 10mm; /* Safe margin for printers */
            }
            
            body {
                background: white;
                visibility: hidden;
                margin: 0;
                padding: 0;
            }

            .no-print { display: none !important; }

            /* Show only the print container */
            #print-queue-container {
                visibility: visible;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                display: block;
            }

            /* Grid for "Fill A4" Mode */
            .print-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr); /* 2 Columns */
                gap: 5mm; /* Cutting gap */
                justify-content: center;
                align-content: start;
            }

            /* Single Card Mode Center */
            .print-single {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 90vh;
            }

            /* --- Card Styling Fixes for Print --- */
            .card-wrapper {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                page-break-inside: avoid;
                margin: 0 auto;
                
                /* Standard CR80 Size in mm */
                width: 85.6mm !important;
                height: 54mm !important;
                transform: scale(1) !important; /* No scaling in print */
            }

            .card-wrapper.portrait {
                width: 54mm !important;
                height: 85.6mm !important;
            }
            
            /* Orientation Overrides based on User Selection */
            body.print-landscape #print-queue-container {
                /* Rotation handled by @page mostly, but fallback just in case */
                width: 297mm;
            }
        }
    </style>
</head>
<body class="bg-slate-100 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-4 md:px-6 py-4 flex items-center justify-between shadow-sm no-print sticky top-0 z-50">
        <div class="flex items-center gap-2 text-indigo-600">
            <i data-lucide="id-card" class="w-7 h-7"></i>
            <h1 class="text-lg md:text-xl font-bold tracking-tight">ID Printer</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="window.print()" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-md active:scale-95">
                <i data-lucide="printer" class="w-4 h-4"></i>
                <span>Print Final</span>
            </button>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full p-4 flex flex-col-reverse md:flex-row gap-6">
        
        <!-- Controls Sidebar -->
        <div class="w-full md:w-1/3 bg-white rounded-xl shadow-sm border border-gray-200 p-5 h-fit no-print overflow-y-auto max-h-[90vh]">
            
            <!-- Design Section -->
            <div class="mb-6 border-b border-gray-100 pb-6">
                <h2 class="text-sm font-bold text-gray-800 flex items-center gap-2 mb-4 uppercase tracking-wider">
                    <i data-lucide="palette" class="w-4 h-4"></i> Design
                </h2>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setTemplate('corporate')" id="btn-corporate" class="template-btn py-2 px-1 text-xs font-medium rounded border transition-all bg-indigo-600 text-white border-indigo-600 shadow-sm">Corporate</button>
                    <button onclick="setTemplate('student')" id="btn-student" class="template-btn py-2 px-1 text-xs font-medium rounded border transition-all bg-white text-gray-600 border-gray-300 hover:bg-gray-50">Student</button>
                    <button onclick="setTemplate('event')" id="btn-event" class="template-btn py-2 px-1 text-xs font-medium rounded border transition-all bg-white text-gray-600 border-gray-300 hover:bg-gray-50">Event</button>
                </div>
            </div>

            <!-- Print Settings Section (NEW) -->
            <div class="mb-6 border-b border-gray-100 pb-6 bg-indigo-50 -mx-5 px-5 py-4">
                <h2 class="text-sm font-bold text-indigo-800 flex items-center gap-2 mb-3 uppercase tracking-wider">
                    <i data-lucide="settings" class="w-4 h-4"></i> Print Settings
                </h2>
                
                <!-- Print Mode -->
                <div class="mb-3">
                    <label class="block text-xs font-medium text-gray-600 mb-1">Print Layout</label>
                    <div class="flex rounded-md shadow-sm" role="group">
                        <button onclick="setPrintMode('single')" id="btn-mode-single" class="px-3 py-2 text-xs font-medium border border-indigo-200 rounded-l-lg bg-white text-gray-700 hover:bg-gray-50 flex-1 focus:z-10 focus:ring-2 focus:ring-indigo-500">
                            Single Card
                        </button>
                        <button onclick="setPrintMode('fill')" id="btn-mode-fill" class="px-3 py-2 text-xs font-medium border border-l-0 border-indigo-200 rounded-r-lg bg-indigo-600 text-white flex-1 focus:z-10 focus:ring-2 focus:ring-indigo-500">
                            Fill A4 (x8)
                        </button>
                    </div>
                    <p class="text-[10px] text-gray-500 mt-1" id="print-hint">Prints 8 copies on one A4 sheet for easy cutting.</p>
                </div>

                <!-- Orientation -->
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">Paper Orientation</label>
                    <select onchange="setOrientation(this.value)" class="w-full text-xs border border-gray-300 rounded p-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="portrait">Portrait (Vertical)</option>
                        <option value="landscape">Landscape (Horizontal)</option>
                    </select>
                </div>
            </div>

            <!-- Input Forms -->
            <div class="space-y-3">
                <h2 class="text-sm font-bold text-gray-800 flex items-center gap-2 mb-2 uppercase tracking-wider">
                    <i data-lucide="user" class="w-4 h-4"></i> Details
                </h2>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Full Name</label>
                    <input type="text" id="inputName" value="Rahul Sharma" oninput="updateCard()" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded text-sm focus:outline-none focus:border-indigo-500 transition-all">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Role / Designation</label>
                    <input type="text" id="inputRole" value="Senior Developer" oninput="updateCard()" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded text-sm focus:outline-none focus:border-indigo-500 transition-all">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">ID Number</label>
                        <input type="text" id="inputId" value="EMP-001" oninput="updateCard()" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded text-sm focus:outline-none focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Location</label>
                        <input type="text" id="inputLocation" value="Mumbai" oninput="updateCard()" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded text-sm focus:outline-none focus:border-indigo-500">
                    </div>
                </div>

                <!-- Photo Upload -->
                <div class="pt-2">
                    <label class="block w-full cursor-pointer group">
                        <input type="file" id="photoInput" class="hidden" accept="image/*" onchange="handleImageUpload(event)">
                        <div class="flex items-center justify-center gap-2 w-full py-3 border border-dashed border-gray-300 rounded-lg text-xs text-gray-600 font-medium group-hover:border-indigo-500 group-hover:text-indigo-600 bg-gray-50 transition-all">
                            <i data-lucide="image-plus" class="w-4 h-4"></i>
                            <span>Change Photo</span>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Preview Area -->
        <div class="w-full md:w-2/3 flex flex-col items-center">
            
            <div class="w-full bg-gray-200/50 rounded-xl border border-gray-200 flex flex-col items-center justify-center p-4 min-h-[450px] relative overflow-hidden">
                <span class="absolute top-2 left-2 bg-gray-300 text-gray-600 text-[10px] px-2 py-1 rounded">Live Preview</span>
                
                <div id="active-card-container" class="preview-container">
                    <!-- Cards will be injected here via JS to allow easy cloning -->
                </div>
            </div>
            
            <!-- Hidden Print Container (Populated dynamically) -->
            <div id="print-queue-container">
                <div id="print-content" class="print-grid"></div>
            </div>

            <p class="text-gray-400 text-xs mt-4 no-print flex items-center gap-2">
                <i data-lucide="info" class="w-3 h-3"></i>
                <span>Use 'Fill A4' to print multiple copies. Use margins: 'None' in printer settings.</span>
            </p>
        </div>

    </main>

    <!-- HIDDEN TEMPLATES SOURCE (Used to generate cards) -->
    <div style="display:none;">
        
        <!-- TEMPLATE 1: CORPORATE -->
        <div id="source-corporate" class="card-wrapper w-[337px] h-[212px] bg-white rounded-lg overflow-hidden flex flex-col relative text-gray-800 shadow-sm border border-gray-200">
            <div class="absolute top-0 left-0 w-full h-full z-0">
                <div class="h-full w-1/3 bg-blue-600 absolute right-0 top-0 skew-x-[-15deg] origin-top translate-x-10"></div>
                <div class="h-24 w-full bg-blue-500 absolute top-0 left-0" style="clip-path: polygon(0 0, 100% 0, 100% 60%, 0% 100%);"></div>
            </div>
            <div class="z-10 relative h-full flex flex-col p-4">
                <div class="flex justify-between items-start text-white">
                    <div class="bg-white/20 p-1 rounded-full"><i data-lucide="shield" class="w-6 h-6 text-white"></i></div>
                    <div class="text-right">
                        <h3 class="font-bold text-sm tracking-wider uppercase">Identity Card</h3>
                        <p class="text-[9px] opacity-90">TechnoSolutions Ltd.</p>
                    </div>
                </div>
                <div class="mt-4 flex items-center gap-4">
                    <div class="w-20 h-20 rounded-full bg-white p-1 shadow-sm shrink-0 z-20">
                        <img class="profile-img w-full h-full rounded-full object-cover bg-gray-100" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rahul" alt="Profile">
                    </div>
                    <div class="text-gray-800 z-20">
                        <h2 class="card-name font-bold text-lg leading-tight">Rahul Sharma</h2>
                        <p class="card-role text-blue-700 font-bold text-[10px] uppercase mt-0.5 bg-blue-50 px-2 py-0.5 rounded inline-block">Senior Developer</p>
                    </div>
                </div>
                <div class="mt-auto flex justify-between items-end border-t border-gray-100 pt-2 z-20 bg-white/50 backdrop-blur-[2px] rounded-b-lg">
                    <div class="text-[10px] text-gray-600 leading-tight">
                        <p class="mb-0.5"><span class="font-bold text-blue-800">ID:</span> <span class="card-id font-mono">EMP-001</span></p>
                        <p><span class="font-bold text-blue-800">LOC:</span> <span class="card-location">Mumbai</span></p>
                    </div>
                    <img class="qr-code w-10 h-10 border border-white shadow-sm" src="" alt="QR">
                </div>
            </div>
        </div>

        <!-- TEMPLATE 2: STUDENT -->
        <div id="source-student" class="card-wrapper portrait w-[212px] h-[337px] bg-white rounded-lg overflow-hidden flex flex-col relative border-b-8 border-orange-500 shadow-sm">
            <!-- Simplified Background for better Print Safety -->
            <div class="bg-orange-500 h-[100px] w-full absolute top-0 rounded-b-[40px] z-0"></div>
            <div class="z-10 flex flex-col items-center mt-6 w-full h-full">
                <div class="w-24 h-24 rounded-full border-4 border-white shadow-md overflow-hidden bg-white z-20">
                    <img class="profile-img w-full h-full object-cover" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Student" alt="Profile">
                </div>
                <div class="text-center mt-2 px-2 w-full z-20">
                    <h2 class="card-name font-extrabold text-lg text-gray-900 leading-tight">Rahul Sharma</h2>
                    <div class="inline-block bg-orange-100 text-orange-700 text-[10px] font-bold px-3 py-1 rounded-full mt-1 uppercase card-role">Senior Developer</div>
                </div>
                <div class="w-full px-5 mt-6 space-y-3 text-left flex-1">
                    <div class="flex items-center gap-3 text-xs border-b border-gray-100 pb-1.5">
                        <div class="w-6 flex justify-center"><i data-lucide="hash" class="w-3.5 h-3.5 text-orange-500"></i></div>
                        <div><p class="text-[9px] text-gray-400 uppercase">ID No</p><p class="card-id font-semibold text-gray-700">EMP-001</p></div>
                    </div>
                    <div class="flex items-center gap-3 text-xs border-b border-gray-100 pb-1.5">
                        <div class="w-6 flex justify-center"><i data-lucide="map-pin" class="w-3.5 h-3.5 text-orange-500"></i></div>
                        <div><p class="text-[9px] text-gray-400 uppercase">Location</p><p class="card-location font-semibold text-gray-700">Mumbai</p></div>
                    </div>
                </div>
                <div class="mt-auto mb-4 flex flex-col items-center">
                    <img class="qr-code w-14 h-14 mix-blend-multiply" src="" alt="QR">
                    <p class="text-[9px] text-gray-400 mt-1">Valid: 2025-26</p>
                </div>
            </div>
        </div>

        <!-- TEMPLATE 3: EVENT -->
        <div id="source-event" class="card-wrapper w-[337px] h-[212px] bg-black text-white rounded-lg overflow-hidden flex relative shadow-sm">
            <div class="w-12 bg-green-500 h-full flex flex-col items-center justify-center relative z-10">
                 <span class="text-black font-black -rotate-90 text-sm tracking-[0.25em] whitespace-nowrap">ACCESS</span>
            </div>
            <div class="flex-1 p-5 flex flex-col relative z-10">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="text-green-400 font-mono text-[10px] tracking-widest mb-1">CONF-2025</h4>
                        <h2 class="card-name text-2xl font-bold text-white leading-none">Rahul Sharma</h2>
                        <p class="card-role text-gray-400 text-[10px] uppercase font-bold mt-1 tracking-wide">Speaker</p>
                    </div>
                    <div class="w-14 h-14 bg-gray-800 rounded border border-gray-700 overflow-hidden shrink-0">
                        <img class="profile-img w-full h-full object-cover" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Event" alt="Profile">
                    </div>
                </div>
                <div class="mt-auto flex items-end justify-between border-t border-gray-800 pt-3">
                    <div class="text-[10px] text-gray-500 font-mono">
                        # <span class="card-id text-gray-300">EMP-001</span>
                    </div>
                    <div class="bg-white p-1 rounded-sm">
                        <img class="qr-code w-10 h-10" src="" alt="QR">
                    </div>
                </div>
            </div>
            <div class="absolute right-0 bottom-0 text-[7rem] font-bold text-white opacity-[0.03] leading-none -mb-4 -mr-4 pointer-events-none z-0">VIP</div>
        </div>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- CONFIGURATION ---
        let currentTemplate = 'corporate';
        let printMode = 'fill'; // 'single' or 'fill'
        let currentOrientation = 'portrait';
        let uploadedImage = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderActiveCard();
            updateCardData();
        });

        function renderActiveCard() {
            // Clear containers
            const activeContainer = document.getElementById('active-card-container');
            const printContent = document.getElementById('print-content');
            activeContainer.innerHTML = '';
            printContent.innerHTML = '';

            // Get Source Template
            const sourceId = `source-${currentTemplate}`;
            const sourceNode = document.getElementById(sourceId);
            
            if(!sourceNode) return;

            // 1. Render for Preview (Single Scaled Card)
            const previewClone = sourceNode.cloneNode(true);
            previewClone.id = 'preview-card';
            previewClone.classList.add('preview-card-scale'); // Add scaling class
            activeContainer.appendChild(previewClone);

            // 2. Render for Print Queue
            if (printMode === 'single') {
                printContent.className = 'print-single';
                const singleClone = sourceNode.cloneNode(true);
                singleClone.id = '';
                printContent.appendChild(singleClone);
            } else {
                printContent.className = 'print-grid';
                // Clone 8 times for A4
                for(let i=0; i<8; i++) {
                    const gridClone = sourceNode.cloneNode(true);
                    gridClone.id = ''; 
                    printContent.appendChild(gridClone);
                }
            }

            // Re-apply data to new nodes
            updateCardData();
            lucide.createIcons();
        }

        function updateCardData() {
            const name = document.getElementById('inputName').value || 'User Name';
            const role = document.getElementById('inputRole').value || 'Role';
            const id = document.getElementById('inputId').value || '000';
            const location = document.getElementById('inputLocation').value || 'City';
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(id)}`;

            // Helper to update all instances (Preview + Print Queue)
            const updateText = (selector, value) => {
                document.querySelectorAll(selector).forEach(el => el.innerText = value);
            };
            const updateSrc = (selector, value) => {
                document.querySelectorAll(selector).forEach(el => el.src = value);
            };

            updateText('.card-name', name);
            updateText('.card-role', role);
            updateText('.card-id', id);
            updateText('.card-location', location);
            updateSrc('.qr-code', qrUrl);

            // Handle Image
            if (uploadedImage) {
                updateSrc('.profile-img', uploadedImage);
            } else {
                // Reset to default dicebear if no upload
                const seeds = {corporate: 'Rahul', student: 'Student', event: 'Event'};
                const defaultUrl = `https://api.dicebear.com/7.x/avataaars/svg?seed=${seeds[currentTemplate]}`;
                // Only reset if it looks like a default avatar currently
                // Ideally we track state properly, but this is simple logic
                if(!uploadedImage) {
                     updateSrc('.profile-img', defaultUrl);
                }
            }
        }

        // --- CONTROLS ---

        function setTemplate(name) {
            currentTemplate = name;
            
            // Update UI Buttons
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.className = "template-btn py-2 px-1 text-xs font-medium rounded border transition-all bg-white text-gray-600 border-gray-300 hover:bg-gray-50";
            });
            document.getElementById(`btn-${name}`).className = "template-btn py-2 px-1 text-xs font-medium rounded border transition-all bg-indigo-600 text-white border-indigo-600 shadow-sm";

            renderActiveCard();
        }

        function setPrintMode(mode) {
            printMode = mode;
            
            // Toggle Button Styles
            const btnSingle = document.getElementById('btn-mode-single');
            const btnFill = document.getElementById('btn-mode-fill');
            const hint = document.getElementById('print-hint');

            if(mode === 'single') {
                btnSingle.className = "px-3 py-2 text-xs font-medium border border-indigo-200 rounded-l-lg bg-indigo-600 text-white flex-1 focus:z-10";
                btnFill.className = "px-3 py-2 text-xs font-medium border border-l-0 border-indigo-200 rounded-r-lg bg-white text-gray-700 hover:bg-gray-50 flex-1 focus:z-10";
                hint.innerText = "Prints a single card in the center of the page.";
            } else {
                btnSingle.className = "px-3 py-2 text-xs font-medium border border-indigo-200 rounded-l-lg bg-white text-gray-700 hover:bg-gray-50 flex-1 focus:z-10";
                btnFill.className = "px-3 py-2 text-xs font-medium border border-l-0 border-indigo-200 rounded-r-lg bg-indigo-600 text-white flex-1 focus:z-10";
                hint.innerText = "Prints 8 copies on one A4 sheet for easy cutting.";
            }

            renderActiveCard();
        }

        function setOrientation(value) {
            currentOrientation = value;
            document.body.classList.remove('print-portrait', 'print-landscape');
            document.body.classList.add(`print-${value}`);
            
            // Note: CSS @page rule handles the actual rotation in most modern browsers, 
            // but this class allows us to style the preview or fallback if needed.
            const style = document.createElement('style');
            style.innerHTML = `@media print { @page { size: A4 ${value}; } }`;
            
            // Remove old dynamic styles
            const oldStyle = document.getElementById('dynamic-print-style');
            if(oldStyle) oldStyle.remove();
            
            style.id = 'dynamic-print-style';
            document.head.appendChild(style);
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    updateCardData();
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Expose updateCard globally for oninput events
        window.updateCard = updateCardData;
        
        // Initial setup
        setPrintMode('fill'); // Default to fill as requested
        setOrientation('portrait');
    </script>
</body>
</html>
